---
description: ç½‘æ˜“äº‘ä¿¡äº’åŠ¨ç™½æ¿SDKå¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ
globs: ["**/*whiteboard*", "**/*board*", "src/views/**/*.vue", "src/typings/**/*.d.ts"]
alwaysApply: true
---

# ç½‘æ˜“äº‘ä¿¡äº’åŠ¨ç™½æ¿SDKå¼€å‘è§„èŒƒ

åŸºäº[å®˜æ–¹APIæ–‡æ¡£v3.9.15](https://doc.yunxin.163.com/whiteboard/api-refer/web/typedoc/Latest/zh/html/index.html)çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

## SDKæ¶æ„ç†è§£

### å››å¤§æ ¸å¿ƒæ¨¡å—
```typescript
// 1. WhiteBoardSDK - ä¸»å®ä¾‹ï¼Œæˆ¿é—´ç®¡ç†
const whiteboardSDK = WhiteBoardSDK.getInstance({...})

// 2. DrawPlugin - ç»˜åˆ¶å’Œæ“ä½œæ ¸å¿ƒ  
whiteboardSDK.joinRoom({...}).then((drawPlugin: DrawPlugin) => {...})

// 3. ToolCollection - å·¥å…·æ UIç®¡ç†
const toolCollection = ToolCollection.getInstance({...})

// 4. RecordPlayer - å½•åƒå›æ”¾ï¼ˆå¯é€‰ï¼‰
RecordPlayer.getInstance({...}).then((player) => {...})
```

### WhiteBoardSDKInstance æ ¸å¿ƒæ–¹æ³•
åŸºäº[å®˜æ–¹æ¥å£æ–‡æ¡£](https://doc.yunxin.163.com/whiteboard/api-refer/web/typedoc/Latest/zh/html/interfaces/WhiteBoardSDK.WhiteBoardSDKInstance.html)ï¼š

```typescript
interface WhiteBoardSDKInstance {
  // æˆ¿é—´æ“ä½œ
  joinRoom(opt: {
    channel: string;              // æˆ¿é—´åç§°
    persistent?: boolean;         // æ˜¯å¦æŒä¹…åŒ–æˆ¿é—´(ä»…G2æ”¯æŒ)
    channelDestroyTime?: number;  // æˆ¿é—´é”€æ¯æ—¶é—´(Unixæ—¶é—´æˆ³)
  }, callback: IJoinRoomCallback): Promise<DrawPlugin>
  
  // ç”Ÿå‘½å‘¨æœŸç®¡ç†
  destroy(): void                 // é”€æ¯SDKï¼Œæ–­å¼€è¿æ¥
  
  // çŠ¶æ€æŸ¥è¯¢
  getUid(): number               // è·å–å½“å‰ç”¨æˆ·UID
  getChannelId(): string         // è·å–å½“å‰é¢‘é“ID(ç”¨äºå½•åƒ)
  isConnected(): boolean         // æ˜¯å¦å·²è¿æ¥
  isSynchronizing(): boolean     // æ˜¯å¦æ­£åœ¨åŒæ­¥
}
```

## SDKåˆå§‹åŒ–è§„èŒƒ

### âœ… æ­£ç¡®çš„åˆå§‹åŒ–æµç¨‹
```typescript
// 1. å¿…é¡»ä½¿ç”¨shallowRefä¿å­˜å®ä¾‹
const whiteboardSDK = shallowRef<WhiteBoardSDKInstance | null>(null)
const toolCollection = shallowRef<ToolCollectionInstance | null>(null)

// 2. é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç›‘æ§
onMounted(async () => {
  try {
    whiteboardSDK.value = WhiteBoardSDK.getInstance({
      appKey: authStore.authParams?.appKey as string,
      uid: Math.ceil(Math.random() * 10000000),
      container: document.getElementById('whiteboard'),
      platform: 'web',
      record: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­å½•åˆ¶
      debug: false,  // ç”Ÿäº§ç¯å¢ƒå…³é—­è°ƒè¯•
      getAuthInfo
    })
    
    // 3. çŠ¶æ€ç›‘æ§
    const checkConnection = () => {
      console.log('SDKè¿æ¥çŠ¶æ€:', whiteboardSDK.value?.isConnected())
      console.log('SDKåŒæ­¥çŠ¶æ€:', whiteboardSDK.value?.isSynchronizing())
    }
    setTimeout(checkConnection, 1000)
    
  } catch (error) {
    console.error('ç™½æ¿SDKåˆå§‹åŒ–å¤±è´¥:', error)
  }
})
```

### âŒ é¿å…çš„é”™è¯¯åšæ³•
```typescript
// é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨refè€Œä¸æ˜¯shallowRef
const whiteboardSDK = ref(null) // âŒ

// é”™è¯¯ï¼šæ²¡æœ‰é”™è¯¯å¤„ç†
const whiteboardSDK = WhiteBoardSDK.getInstance({...}) // âŒ

// é”™è¯¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯è°ƒè¯•
debug: true // âŒ
```

## DrawPluginæ“ä½œè§„èŒƒ

### DrawPlugin æ ¸å¿ƒæ¥å£åˆ†ç±»
åŸºäº[å®˜æ–¹DrawPluginæ¥å£æ–‡æ¡£](https://doc.yunxin.163.com/whiteboard/api-refer/web/typedoc/Latest/zh/html/interfaces/DrawPlugin.DrawPlugin-1.html)ï¼š

```typescript
interface DrawPlugin {
  // === åŸºæœ¬æ“ä½œ ===
  enableDraw(enable: boolean): void               // å¯ç”¨/ç¦ç”¨ç»˜åˆ¶
  setAppConfig(config: Partial<IAppConfig>): void // è®¾ç½®åº”ç”¨é…ç½®
  setShowCursor(show: boolean): void              // è®¾ç½®é¼ æ ‡å¹¿æ’­
  setNickName(name: string): void                 // è®¾ç½®æ˜µç§°

  // === ç”»å¸ƒæ“ä½œ ===
  clear(): void                                   // æ¸…ç©ºç”»å¸ƒ
  undo(): void                                    // æ’¤é”€æ“ä½œ
  redo(): void                                    // é‡åšæ“ä½œ
  duplicate(): void                               // å¤åˆ¶é€‰ä¸­å…ƒç´ 
  setTool(toolName: string, payload?: IMacroPayload): void // è®¾ç½®æ•™å…·
  setStrokeColor(type: 'link'|'shape'|'pen', color: string): void // è®¾ç½®é¢œè‰²
  setStrokeWidth(type: 'link'|'shape'|'pen', width: number): void // è®¾ç½®çº¿å®½

  // === æ–‡æ¡£/Boardæ“ä½œ ===
  addDoc(opt: {docName: string, params: IStaticDocParam}): string           // æ·»åŠ é™æ€æ–‡æ¡£
  addTransDoc(opt: {docName: string, pageCount: number, width: number, height: number, url: string}): string // æ·»åŠ åŠ¨æ€PPT
  addBoard(docName: string, pageCount: number): string     // æ·»åŠ ç©ºç™½Board
  gotoBoard(boardName: string): void                       // è·³è½¬Board
  deleteBoard(boardName: string): void                     // åˆ é™¤Board
  getBoardInfos(): IBoardInfos                            // è·å–Boardä¿¡æ¯
  hasTransDoc(): boolean                                   // æ˜¯å¦ä¸ºåŠ¨æ€æ–‡æ¡£
  exportBoards(opt: {boardNames: string[], fileName?: string, download?: boolean}): object // å¯¼å‡ºç™½æ¿
  importBoards(opt: {url: string, boardNames?: string[], overwrite?: boolean}): void       // å¯¼å…¥ç™½æ¿

  // === é¡µé¢æ“ä½œ ===
  addPage(opt: {insertAfter?: number, payload: any}): void // æ·»åŠ é¡µé¢
  gotoPage(index: number): void                           // è·³è½¬é¡µé¢
  gotoFirstPage(): void                                   // ç¬¬ä¸€é¡µ
  gotoLastPage(): void                                    // æœ€åä¸€é¡µ
  gotoNextPage(): void                                    // ä¸‹ä¸€é¡µ
  gotoPrevPage(): void                                    // ä¸Šä¸€é¡µ
  deletePage(index: number): void                         // åˆ é™¤é¡µé¢
  getPageInfos(boardName?: string): IPageInfos           // è·å–é¡µé¢ä¿¡æ¯

  // === åŠ¨ç”»æ“ä½œï¼ˆPPTï¼‰===
  nextAnim(): void                                        // ä¸‹ä¸€åŠ¨ç”»
  prevAnim(): void                                        // ä¸Šä¸€åŠ¨ç”»
  gotoAnim(opt: {pageIndex: number, animIndex: number, animState: 'start'|'end'}): void // è·³è½¬åŠ¨ç”»
  getAnimInfos(): {pageIndex: number, animIndex: number, animState: string} | null      // è·å–åŠ¨ç”»ä¿¡æ¯
  hasBackground(): boolean                                // æ˜¯å¦æœ‰èƒŒæ™¯

  // === è§†è§’æ“ä½œ ===
  fitToContent(animate: boolean): void                    // é€‚é…å†…å®¹
  fitToDoc(animate: boolean): void                        // é€‚é…æ–‡æ¡£
  resetCamera(animate: boolean): void                     // é‡ç½®è§†è§’
  setCameraBound(bound: ICameraBound, animate: boolean): void // è®¾ç½®è§†è§’
  getCameraBound(): {centerX: number, centerY: number, width: number, height: number} // è·å–è§†è§’
  zoomIn(): void                                          // æ”¾å¤§
  zoomOut(): void                                         // ç¼©å°
  zoomTo(scale: number, animate: boolean): void           // ç¼©æ”¾åˆ°æŒ‡å®šå€æ•°
  getZoomFactor(): number                                 // è·å–ç¼©æ”¾å€æ•°

  // === è§†è§’åŒæ­¥ ===
  setSelfAsBroadcaster(): void                           // è®¾ä¸ºä¸»æ’­
  unsetSelfAsBroadcaster(): void                         // åœæ­¢ä¸»æ’­
  setSelfAsFollower(): void                              // è·Ÿéšä¸»æ’­
  setSelfAsFreeObserver(): void                          // è‡ªç”±è§‚çœ‹
  getVisionState(): {mode: string, broadcasterName?: string, broadcaster?: string} // è·å–è§†è§’çŠ¶æ€

  // === åª’ä½“æ“ä½œ ===
  addImage(opt: {url: string, pageIndex?: number, boardName?: string, antiLeechProp?: IAntiLeechProp}): void // æ·»åŠ å›¾ç‰‡
  addVideo(opt: {url: string, sourceType: string, title?: string, pageIndex?: number, boardName?: string}): void // æ·»åŠ è§†é¢‘
  addAudio(opt: {url: string, sourceType: string, title?: string, pageIndex?: number, boardName?: string}): void // æ·»åŠ éŸ³é¢‘
  setPageBackground(opt: {url: string, width: number, height: number, antiLeechProp?: IAntiLeechProp}): void    // è®¾ç½®èƒŒæ™¯

  // === å¯¼å‡ºåŠŸèƒ½ ===
  exportAsImage(opt?: {type?: 'jpeg'|'png', quality?: number, content?: string}): void                    // å¯¼å‡ºå›¾ç‰‡
  exportAsBase64String(opt?: {type?: 'jpeg'|'png', quality?: number, content?: string}): object          // å¯¼å‡ºBase64
  exportBoardAsStr(opt: object, callbacks: {onComplete: Function, onResourceProgress?: Function}): void   // å¯¼å‡ºå­—ç¬¦ä¸²

  // === æµæ“ä½œ ===
  getStream(opt?: {width?: number, keepDPI?: boolean, frameRate?: number}): MediaStream  // è·å–è§†é¢‘æµ
  updateStream(opt?: {width?: number, keepDPI?: boolean}): MediaStream                   // æ›´æ–°æµå‚æ•°
  stopStream(): void                                                                     // åœæ­¢æµ

  // === çŠ¶æ€æŸ¥è¯¢ ===
  getUndoCount(): number                                 // å¯æ’¤é”€æ¬¡æ•°
  getRedoCount(): number                                 // å¯é‡åšæ¬¡æ•°
  isClearAvailable(): boolean                            // æ˜¯å¦å¯æ¸…ç©º
  getSelectedIds(): string[]                             // é€‰ä¸­å…ƒç´ IDåˆ—è¡¨
  getCurrTool(): string                                  // å½“å‰å·¥å…·
  getDefStyles(): IStyle                                 // é»˜è®¤æ ·å¼
  getPageElementInfos(): Array<{id: string, type: string, visible: boolean}> // é¡µé¢å…ƒç´ ä¿¡æ¯
  getResourceMetadata(opt: {url: string, type: 'image'|'video'|'audio'}): IResourceMetaData // èµ„æºå…ƒæ•°æ®
  isCameraReady(): boolean                               // ç›¸æœºæ˜¯å¦å°±ç»ª

  // === è‡ªå®šä¹‰èƒŒæ™¯ ===
  setCustomBackground(coordinate: 'world'|'container', customFn: Function, bgName: string): void // è®¾ç½®è‡ªå®šä¹‰èƒŒæ™¯
  unsetCustomBackground(): void                          // å–æ¶ˆè‡ªå®šä¹‰èƒŒæ™¯
  getBgRendererName(): string                            // è·å–èƒŒæ™¯åç§°

  // === é«˜çº§åŠŸèƒ½ ===
  lockCameraWithContent(opt: {width: number, height: number}): void           // é”å®šç›¸æœº
  unlockCameraWithContent(): void                                             // è§£é”ç›¸æœº
  updateContainerAfterResize(): void                                          // å®¹å™¨å°ºå¯¸å˜åŒ–åæ›´æ–°
  rotateElement(opt: {id: string, angle: number}): void                       // æ—‹è½¬å…ƒç´ 
  setElementsVisibility(opt: {ids?: string[], visible: boolean}): void        // è®¾ç½®å…ƒç´ å¯è§æ€§
  setFontFamilies(fontFamilies: Array<IFont>): void                          // è®¾ç½®å­—ä½“
  getFontFamilies(): Array<IFont>                                            // è·å–å­—ä½“

  // === äº‹ä»¶ç›‘å¬ ===
  on(eventName: string, callback: Function): void        // æ³¨å†Œäº‹ä»¶ç›‘å¬
}
```

### æ–‡æ¡£æ“ä½œæœ€ä½³å®è·µ
```typescript
// âœ… æ ‡å‡†çš„Boardæ“ä½œæµç¨‹
async function handleBoardOperations(drawPlugin: DrawPlugin) {
  // 1. è·å–å½“å‰Boardä¿¡æ¯
  const boardInfos = drawPlugin.getBoardInfos()
  console.log('å½“å‰Board:', boardInfos.currBoard)
  console.log('æ‰€æœ‰Board:', boardInfos.boardNames)
  
  // 2. æ·»åŠ åŠ¨æ€æ–‡æ¡£ï¼ˆPPTï¼‰
  const transDocBoardName = drawPlugin.addTransDoc({
    docName: 'PPTè¯¾ä»¶',
    pageCount: 57,
    width: 960,
    height: 540,
    url: 'https://wb.vod.126.net/.../index.json'
  })
  
  // 3. æ·»åŠ é™æ€æ–‡æ¡£ï¼ˆPDFï¼‰
  const staticDocBoardName = drawPlugin.addDoc({
    docName: 'PDFæ–‡æ¡£',
    params: {
      template: "https://domain.com/{index}.jpg",
      width: 1920,
      height: 1080,
      offset: 1,
      pageCount: 10
    }
  })
  
  // 4. Boardè·³è½¬
  drawPlugin.gotoBoard(transDocBoardName)
}
```

### é¡µé¢å¯¼èˆªè§„èŒƒ
```typescript
// âœ… å®Œæ•´çš„é¡µé¢æ§åˆ¶åŠŸèƒ½
function setupPageNavigation(drawPlugin: DrawPlugin) {
  // é¡µé¢æ“ä½œ
  const pageOperations = {
    // åŸºç¡€å¯¼èˆª
    nextPage: () => drawPlugin.gotoNextPage(),
    prevPage: () => drawPlugin.gotoPrevPage(),
    firstPage: () => drawPlugin.gotoFirstPage(),
    lastPage: () => drawPlugin.gotoLastPage(),
    gotoPage: (index: number) => drawPlugin.gotoPage(index),
    
    // åŠ¨ç”»æ§åˆ¶ï¼ˆä»…PPTï¼‰
    nextAnim: () => drawPlugin.nextAnim(),
    prevAnim: () => drawPlugin.prevAnim(),
    gotoAnim: (opt: {pageIndex: number, animIndex: number, animState: 'start'|'end'}) => 
      drawPlugin.gotoAnim(opt),
    
    // é¡µé¢ç®¡ç†
    addPage: (payload?: any) => drawPlugin.addPage({payload}),
    deletePage: (index: number) => drawPlugin.deletePage(index),
    
    // çŠ¶æ€æŸ¥è¯¢
    getPageInfos: () => drawPlugin.getPageInfos(),
    getAnimInfos: () => drawPlugin.getAnimInfos(),
    hasTransDoc: () => drawPlugin.hasTransDoc()
  }
  
  return pageOperations
}
```

### è§†è§’å’Œç¼©æ”¾æ§åˆ¶
```typescript
// âœ… è§†è§’æ“ä½œè§„èŒƒ
function setupViewportControls(drawPlugin: DrawPlugin) {
  return {
    // é€‚é…æ“ä½œ
    fitToContent: (animate = true) => drawPlugin.fitToContent(animate),
    fitToDoc: (animate = true) => drawPlugin.fitToDoc(animate),
    resetCamera: (animate = true) => drawPlugin.resetCamera(animate),
    
    // ç¼©æ”¾æ§åˆ¶
    zoomIn: () => drawPlugin.zoomIn(),
    zoomOut: () => drawPlugin.zoomOut(),
    zoomTo: (scale: number, animate = true) => drawPlugin.zoomTo(scale, animate),
    getZoomFactor: () => drawPlugin.getZoomFactor(),
    
    // è§†è§’åŒæ­¥
    setSelfAsBroadcaster: () => drawPlugin.setSelfAsBroadcaster(),
    unsetSelfAsBroadcaster: () => drawPlugin.unsetSelfAsBroadcaster(),
    setSelfAsFollower: () => drawPlugin.setSelfAsFollower(),
    setSelfAsFreeObserver: () => drawPlugin.setSelfAsFreeObserver()
  }
}
```

## ToolCollectionå·¥å…·æ è§„èŒƒ

### å·¥å…·æ é…ç½®æœ€ä½³å®è·µ
```typescript
// âœ… æ ‡å‡†å·¥å…·æ è®¾ç½®
function setupToolCollection(drawPlugin: DrawPlugin, container: HTMLElement) {
  const toolCollection = ToolCollection.getInstance({
    container,
    handler: drawPlugin,
    options: {
      platform: 'web'
    }
  })
  
  // æ˜¾ç¤ºå·¥å…·æ 
  toolCollection.show()
  
  // ç§»é™¤ä¸éœ€è¦çš„å·¥å…·
  toolCollection.removeTool({
    position: 'left',
    name: 'uploadCenter'
  })
  
  // ç§»é™¤å­é¡¹ç›®
  toolCollection.removeSubItem({
    baseTool: 'multiInOne',
    subItemName: 'preview'
  })
  
  // è®¾ç½®é»˜è®¤å¤§å°
  toolCollection.setItemDefaultSize(36)
  
  // äº‹ä»¶ç›‘å¬
  toolCollection.on('docAdd', (docList, allDocs) => {
    console.log('æ–‡æ¡£æ·»åŠ äº‹ä»¶:', docList, allDocs)
  })
  
  return toolCollection
}
```

### åŠ¨æ€å·¥å…·æ æ§åˆ¶
```typescript
// âœ… åŸºäºæ–‡æ¡£ç±»å‹çš„åŠ¨æ€å·¥å…·æ 
function setupDynamicToolbar(drawPlugin: DrawPlugin, toolCollection: ToolCollectionInstance) {
  let hasTransDoc = false
  
  drawPlugin.on('event:appState:change', (stateName: string) => {
    if (stateName === 'board') {
      if (!hasTransDoc && drawPlugin.hasTransDoc()) {
        // åˆ‡æ¢åˆ°åŠ¨æ€æ–‡æ¡£ï¼ˆPPTï¼‰- æ˜¾ç¤ºåŠ¨ç”»æ§åˆ¶
        hasTransDoc = true
        toolCollection.addOrSetContainer({
          position: 'bottomRight',
          items: [
            { tool: 'prevPage', hint: 'ä¸Šä¸€é¡µ' },
            { tool: 'prevAnim', hint: 'ä¸Šä¸€åŠ¨ç”»' },
            { tool: 'pageInfo' },
            { tool: 'nextAnim', hint: 'ä¸‹ä¸€åŠ¨ç”»' },
            { tool: 'nextPage', hint: 'ä¸‹ä¸€é¡µ' },
            { tool: 'preview', hint: 'é¢„è§ˆ', previewSliderPosition: 'right' }
          ]
        })
      } else if (hasTransDoc && !drawPlugin.hasTransDoc()) {
        // åˆ‡æ¢åˆ°é™æ€æ–‡æ¡£ - æ˜¾ç¤ºé¡µé¢æ§åˆ¶
        hasTransDoc = false
        toolCollection.addOrSetContainer({
          position: 'bottomRight',
          items: [
            { tool: 'firstPage', hint: 'ç¬¬ä¸€é¡µ' },
            { tool: 'prevPage', hint: 'ä¸Šä¸€é¡µ' },
            { tool: 'pageInfo' },
            { tool: 'nextPage', hint: 'ä¸‹ä¸€é¡µ' },
            { tool: 'lastPage', hint: 'æœ€åä¸€é¡µ' },
            { tool: 'preview', hint: 'é¢„è§ˆ', previewSliderPosition: 'right' }
          ]
        })
      }
    }
  })
}
```

## äº‹ä»¶å¤„ç†è§„èŒƒ

### çŠ¶æ€å˜åŒ–ç›‘å¬
```typescript
// âœ… å®Œæ•´çš„äº‹ä»¶ç›‘å¬è®¾ç½®
function setupEventListeners(drawPlugin: DrawPlugin) {
  // Boardå˜åŒ–ç›‘å¬
  drawPlugin.on('event:appState:change', (stateName, value) => {
    switch (stateName) {
      case 'board':
        console.log('Boardåˆ‡æ¢:', value)
        break
      case 'page':
        console.log('é¡µé¢åˆ‡æ¢:', value)
        break
      case 'zoomFactor':
        console.log('ç¼©æ”¾å˜åŒ–:', value)
        break
      case 'currTool':
        console.log('å·¥å…·åˆ‡æ¢:', value)
        break
      case 'vision':
        console.log('è§†è§’å˜åŒ–:', value)
        break
      case 'selectChange':
        console.log('é€‰æ‹©å˜åŒ–:', value)
        break
    }
  })
  
  // èµ„æºåŠ è½½ç›‘å¬
  drawPlugin.on('event:resource:onload', (resource) => {
    console.log(`${resource.type}: ${resource.url} åŠ è½½${resource.loaded ? 'æˆåŠŸ' : 'å¤±è´¥'}`)
  })
  
  // å¯¼å…¥ç™½æ¿äº‹ä»¶
  drawPlugin.on('event:importBoard', (action) => {
    if (action === 'start') {
      console.log('å¼€å§‹å¯¼å…¥ç™½æ¿')
    } else if (action === 'finish') {
      console.log('ç™½æ¿å¯¼å…¥å®Œæˆ')
    }
  })
}
```

## æˆ¿é—´ç”Ÿå‘½å‘¨æœŸç®¡ç†

### IJoinRoomCallback å›è°ƒè§„èŒƒ
åŸºäº[å®˜æ–¹æ–‡æ¡£](https://doc.yunxin.163.com/whiteboard/api-refer/web/typedoc/Latest/zh/html/interfaces/WhiteBoardSDK.WhiteBoardSDKInstance.html#joinRoom)ï¼š

```typescript
// âœ… å®Œæ•´çš„æˆ¿é—´å›è°ƒå¤„ç†
interface IJoinRoomCallback {
  ondisconnected?: (error?: any) => void    // æ–­å¼€è¿æ¥å›è°ƒ
  onwillreconnect?: () => void             // å³å°†é‡è¿å›è°ƒ
  onconnected?: () => void                 // è¿æ¥æˆåŠŸå›è°ƒ
  onSyncStart?: () => void                 // å¼€å§‹åŒæ­¥å›è°ƒ
  onSyncFinish?: () => void                // åŒæ­¥å®Œæˆå›è°ƒ
}

function setupRoomCallbacks(): IJoinRoomCallback {
  return {
    ondisconnected: (error) => {
      console.error('ğŸ”´ æˆ¿é—´è¿æ¥æ–­å¼€:', error)
      // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æ–­çº¿æç¤º
      WhiteBoardSDK.showToast({
        type: 'error',
        msg: 'ç½‘ç»œè¿æ¥ä¸­æ–­ï¼Œæ­£åœ¨å°è¯•é‡è¿...',
        time: 5000
      })
      
      // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†é‡è¿é€»è¾‘æˆ–ç”¨æˆ·å¼•å¯¼
      handleDisconnection(error)
    },
    
    onwillreconnect: () => {
      console.log('ğŸŸ¡ å‡†å¤‡é‡è¿æˆ¿é—´...')
      WhiteBoardSDK.showToast({
        type: 'info',
        msg: 'æ­£åœ¨é‡æ–°è¿æ¥...',
        time: 3000
      })
    },
    
    onconnected: () => {
      console.log('ğŸŸ¢ æˆ¿é—´è¿æ¥æˆåŠŸ!')
      WhiteBoardSDK.hideToast()
      // è¿æ¥æˆåŠŸåçš„åˆå§‹åŒ–æ“ä½œ
      onRoomConnected()
    },
    
    onSyncStart: () => {
      console.log('ğŸ”„ å¼€å§‹åŒæ­¥ç™½æ¿æ•°æ®...')
      // å¯ä»¥æ˜¾ç¤ºåŒæ­¥è¿›åº¦æŒ‡ç¤ºå™¨
      showSyncProgress(true)
    },
    
    onSyncFinish: () => {
      console.log('âœ… ç™½æ¿æ•°æ®åŒæ­¥å®Œæˆ!')
      // éšè—åŒæ­¥è¿›åº¦æŒ‡ç¤ºå™¨
      showSyncProgress(false)
    }
  }
}

// è¾…åŠ©å‡½æ•°
function handleDisconnection(error: any) {
  // è®°å½•æ–­çº¿åŸå› 
  console.error('æ–­çº¿è¯¦ç»†ä¿¡æ¯:', {
    error,
    timestamp: new Date().toISOString(),
    userAgent: navigator.userAgent
  })
  
  // æ ¹æ®é”™è¯¯ç±»å‹è¿›è¡Œä¸åŒå¤„ç†
  if (error?.code === 'NETWORK_ERROR') {
    // ç½‘ç»œé—®é¢˜
  } else if (error?.code === 'AUTH_FAILED') {
    // è®¤è¯å¤±è´¥ï¼Œå¯èƒ½éœ€è¦é‡æ–°è·å–token
  }
}

function onRoomConnected() {
  // æˆ¿é—´è¿æ¥æˆåŠŸåçš„æ“ä½œ
  console.log('æˆ¿é—´è¿æ¥æˆåŠŸï¼Œå¼€å§‹åˆå§‹åŒ–ç™½æ¿åŠŸèƒ½...')
}

function showSyncProgress(show: boolean) {
  // æ˜¾ç¤º/éšè—åŒæ­¥è¿›åº¦UI
  if (show) {
    console.log('æ˜¾ç¤ºåŒæ­¥è¿›åº¦æŒ‡ç¤ºå™¨')
  } else {
    console.log('éšè—åŒæ­¥è¿›åº¦æŒ‡ç¤ºå™¨')
  }
}
```

### æˆ¿é—´çŠ¶æ€ç›‘æ§
```typescript
// âœ… å®æ—¶çŠ¶æ€ç›‘æ§
function setupConnectionMonitor(whiteboardSDK: WhiteBoardSDKInstance) {
  const monitorInterval = setInterval(() => {
    const status = {
      isConnected: whiteboardSDK.isConnected(),
      isSynchronizing: whiteboardSDK.isSynchronizing(),
      uid: whiteboardSDK.getUid(),
      channelId: whiteboardSDK.getChannelId(),
      timestamp: new Date().toISOString()
    }
    
    console.log('ğŸ“Š æˆ¿é—´çŠ¶æ€:', status)
    
    // æ£€æŸ¥å¼‚å¸¸çŠ¶æ€
    if (!status.isConnected && !status.isSynchronizing) {
      console.warn('âš ï¸  æˆ¿é—´è¿æ¥å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦é‡è¿')
    }
    
    if (status.isSynchronizing) {
      console.info('ğŸ”„ æ­£åœ¨åŒæ­¥æ•°æ®ï¼Œè¯·ç¨å€™...')
    }
    
  }, 10000) // æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
  
  // æ¸…ç†å‡½æ•°
  return () => clearInterval(monitorInterval)
}

// ä½¿ç”¨ç¤ºä¾‹
onMounted(() => {
  const cleanupMonitor = setupConnectionMonitor(whiteboardSDK.value!)
  
  onUnmounted(() => {
    cleanupMonitor()
  })
})
```

## é”™è¯¯å¤„ç†å’Œè°ƒè¯•

### ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼
```typescript
// âœ… æ ‡å‡†é”™è¯¯å¤„ç†
async function safeApiCall<T>(
  apiCall: () => T,
  errorContext: string
): Promise<T | null> {
  try {
    return apiCall()
  } catch (error) {
    console.error(`${errorContext}å¤±è´¥:`, error)
    // Toastæç¤ºç”¨æˆ·
    WhiteBoardSDK.showToast({
      type: 'error',
      msg: `${errorContext}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`,
      time: 3000
    })
    return null
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const boardInfos = await safeApiCall(
  () => drawPlugin.getBoardInfos(),
  'è·å–Boardä¿¡æ¯'
)
```

### è°ƒè¯•å·¥å…·è®¾ç½®
```typescript
// âœ… å¼€å‘ç¯å¢ƒè°ƒè¯•å·¥å…·
if (import.meta.env.DEV) {
  // å…¨å±€è°ƒè¯•API
  (window as any).whiteboardDebug = {
    // SDKçŠ¶æ€
    getSDKStatus: () => ({
      uid: whiteboardSDK.value?.getUid(),
      channelId: whiteboardSDK.value?.getChannelId(),
      isConnected: whiteboardSDK.value?.isConnected(),
      isSynchronizing: whiteboardSDK.value?.isSynchronizing()
    }),
    
    // ç»˜åˆ¶çŠ¶æ€
    getDrawStatus: () => ({
      undoCount: drawPlugin.getUndoCount(),
      redoCount: drawPlugin.getRedoCount(),
      zoomFactor: drawPlugin.getZoomFactor(),
      currTool: drawPlugin.getCurrTool(),
      selectedIds: drawPlugin.getSelectedIds(),
      isClearAvailable: drawPlugin.isClearAvailable()
    }),
    
    // Boardä¿¡æ¯
    getBoardStatus: () => drawPlugin.getBoardInfos(),
    getPageStatus: () => drawPlugin.getPageInfos(),
    getAnimStatus: () => drawPlugin.getAnimInfos()
  }
}
```

## æ€§èƒ½ä¼˜åŒ–è§„åˆ™

### å†…å­˜ç®¡ç†
```typescript
// âœ… æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
onUnmounted(() => {
  // æ¸…ç†èµ„æº
  if (whiteboardSDK.value) {
    whiteboardSDK.value.destroy()
  }
  
  if (toolCollection.value) {
    toolCollection.value.hide()
  }
  
  // åœæ­¢è§†é¢‘æµ
  drawPlugin?.stopStream()
})
```

### é˜²æŠ–å’ŒèŠ‚æµ
```typescript
// âœ… é«˜é¢‘æ“ä½œä¼˜åŒ–
import { debounce, throttle } from 'lodash-es'

const debouncedZoom = debounce((scale: number) => {
  drawPlugin.zoomTo(scale, true)
}, 300)

const throttledPan = throttle((x: number, y: number) => {
  drawPlugin.setCameraBound({
    centerX: x,
    centerY: y,
    width: 1920,
    height: 1080
  }, false)
}, 100)
```

## ç±»å‹å®‰å…¨è§„åˆ™

### ä¸¥æ ¼ç±»å‹å®šä¹‰
```typescript
// âœ… ä½¿ç”¨å®˜æ–¹ç±»å‹å®šä¹‰
import type { 
  DrawPlugin, 
  WhiteBoardSDKInstance,
  ToolCollectionInstance,
  IBoardInfos,
  IPageInfos,
  IAppConfig 
} from '@/typings/'

// âœ… æ‰©å±•ç±»å‹å®šä¹‰
interface WhiteboardState {
  sdk: WhiteBoardSDKInstance | null
  drawPlugin: DrawPlugin | null
  toolCollection: ToolCollectionInstance | null
  isReady: boolean
  error: string | null
}
```

## å®‰å…¨è§„èŒƒ

### è®¤è¯å’Œæƒé™
```typescript
// âœ… å®‰å…¨çš„è®¤è¯å®ç°
function getAuthInfo(): Promise<{
  nonce: string
  channelDestroyTime: number
  checksum: string
  curTime: number
}> {
  const nonce = Math.random().toString(36).substring(2, 36)
  const curTime = Math.round(Date.now() / 1000)
  
  // ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„å¯†é’¥
  const checksum = SHA1(
    import.meta.env.VITE_APP_SECRET + nonce + curTime
  ).toString()
  
  return Promise.resolve({
    nonce,
    channelDestroyTime: 0,
    checksum,
    curTime
  })
}
```

## æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•
```typescript
// âœ… ç™½æ¿åŠŸèƒ½æµ‹è¯•
describe('WhiteBoard Operations', () => {
  test('should initialize SDK correctly', async () => {
    const sdk = WhiteBoardSDK.getInstance({...})
    expect(sdk).toBeDefined()
    expect(sdk.getUid()).toBeTruthy()
  })
  
  test('should handle board navigation', () => {
    const boardInfos = drawPlugin.getBoardInfos()
    expect(boardInfos.boardNames).toBeInstanceOf(Array)
    expect(boardInfos.currBoard).toBeTruthy()
  })
})
```

## æ–‡æ¡£è§„èŒƒ

### APIä½¿ç”¨æ–‡æ¡£
```typescript
/**
 * è·³è½¬åˆ°æŒ‡å®šBoard
 * @param boardName - Boardå†…éƒ¨åç§°ï¼ˆç”±addDoc/addTransDoc/addBoardè¿”å›ï¼‰
 * @example
 * ```typescript
 * const boardName = drawPlugin.addBoard('æ–°ç™½æ¿', 1)
 * drawPlugin.gotoBoard(boardName)
 * ```
 */
function gotoBoard(boardName: string): void {
  drawPlugin.gotoBoard(boardName)
}
```

éµå¾ªè¿™äº›è§„èŒƒå¯ä»¥ç¡®ä¿ç½‘æ˜“äº‘ä¿¡ç™½æ¿SDKçš„æ­£ç¡®ä½¿ç”¨å’Œæœ€ä½³æ€§èƒ½è¡¨ç°ã€‚